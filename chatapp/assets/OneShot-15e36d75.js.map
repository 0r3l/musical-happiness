{"version":3,"file":"OneShot-15e36d75.js","sources":["../../../../src/components/SettingsButton/SettingsButton.tsx","../../../../src/pages/oneshot/OneShot.tsx"],"sourcesContent":["import { Settings24Regular } from \"@fluentui/react-icons\";\nimport { Button } from \"@fluentui/react-components\";\n\nimport styles from \"./SettingsButton.module.css\";\n\ninterface Props {\n    className?: string;\n    onClick: () => void;\n}\n\nexport const SettingsButton = ({ className, onClick }: Props) => {\n    return (\n        <div className={`${styles.container} ${className ?? \"\"}`}>\n            <Button icon={<Settings24Regular />} onClick={onClick}>\n                {\"Settings\"}\n            </Button>\n        </div>\n    );\n};\n","import { useRef, useState } from \"react\";\nimport { Checkbox, ChoiceGroup, IChoiceGroupOption, Panel, DefaultButton, Spinner, TextField, SpinButton, IDropdownOption, Dropdown } from \"@fluentui/react\";\n\nimport styles from \"./OneShot.module.css\";\n\nimport { askApi, ChatAppResponse, ChatAppRequest, RetrievalMode } from \"../../api\";\nimport { Answer, AnswerError } from \"../../components/Answer\";\nimport { QuestionInput } from \"../../components/QuestionInput\";\nimport { ExampleList } from \"../../components/Example\";\nimport { AnalysisPanel, AnalysisPanelTabs } from \"../../components/AnalysisPanel\";\nimport { SettingsButton } from \"../../components/SettingsButton/SettingsButton\";\nimport { useLogin, getToken } from \"../../authConfig\";\nimport { useMsal } from \"@azure/msal-react\";\nimport { TokenClaimsDisplay } from \"../../components/TokenClaimsDisplay\";\n\nexport function Component(): JSX.Element {\n    const [isConfigPanelOpen, setIsConfigPanelOpen] = useState(false);\n    const [promptTemplate, setPromptTemplate] = useState<string>(\"\");\n    const [promptTemplatePrefix, setPromptTemplatePrefix] = useState<string>(\"\");\n    const [promptTemplateSuffix, setPromptTemplateSuffix] = useState<string>(\"\");\n    const [retrievalMode, setRetrievalMode] = useState<RetrievalMode>(RetrievalMode.Code);\n    const [retrieveCount, setRetrieveCount] = useState<number>(3);\n    const [useSemanticRanker, setUseSemanticRanker] = useState<boolean>(true);\n    const [useSemanticCaptions, setUseSemanticCaptions] = useState<boolean>(false);\n    const [excludeCategory, setExcludeCategory] = useState<string>(\"\");\n    const [useOidSecurityFilter, setUseOidSecurityFilter] = useState<boolean>(false);\n    const [useGroupsSecurityFilter, setUseGroupsSecurityFilter] = useState<boolean>(false);\n\n    const lastQuestionRef = useRef<string>(\"\");\n\n    const [isLoading, setIsLoading] = useState<boolean>(false);\n    const [error, setError] = useState<unknown>();\n    const [answer, setAnswer] = useState<ChatAppResponse>();\n\n    const [activeCitation, setActiveCitation] = useState<string>();\n    const [activeAnalysisPanelTab, setActiveAnalysisPanelTab] = useState<AnalysisPanelTabs | undefined>(undefined);\n\n    const client = useLogin ? useMsal().instance : undefined;\n\n    const makeApiRequest = async (question: string) => {\n        lastQuestionRef.current = question;\n\n        error && setError(undefined);\n        setIsLoading(true);\n        setActiveCitation(undefined);\n        setActiveAnalysisPanelTab(undefined);\n\n        const token = client ? await getToken(client) : undefined;\n\n        try {\n            const request: ChatAppRequest = {\n                messages: [\n                    {\n                        content: question,\n                        role: \"user\"\n                    }\n                ],\n                context: {\n                    overrides: {\n                        prompt_template: promptTemplate.length === 0 ? undefined : promptTemplate,\n                        prompt_template_prefix: promptTemplatePrefix.length === 0 ? undefined : promptTemplatePrefix,\n                        prompt_template_suffix: promptTemplateSuffix.length === 0 ? undefined : promptTemplateSuffix,\n                        exclude_category: excludeCategory.length === 0 ? undefined : excludeCategory,\n                        top: retrieveCount,\n                        retrieval_mode: retrievalMode,\n                        semantic_ranker: useSemanticRanker,\n                        semantic_captions: useSemanticCaptions,\n                        use_oid_security_filter: useOidSecurityFilter,\n                        use_groups_security_filter: useGroupsSecurityFilter\n                    }\n                },\n                // ChatAppProtocol: Client must pass on any session state received from the server\n                session_state: answer ? answer.choices[0].session_state : null\n            };\n            const result = await askApi(request, token?.accessToken);\n            setAnswer(result);\n        } catch (e) {\n            setError(e);\n        } finally {\n            setIsLoading(false);\n        }\n    };\n\n    const onPromptTemplateChange = (_ev?: React.FormEvent<HTMLInputElement | HTMLTextAreaElement>, newValue?: string) => {\n        setPromptTemplate(newValue || \"\");\n    };\n\n    const onPromptTemplatePrefixChange = (_ev?: React.FormEvent<HTMLInputElement | HTMLTextAreaElement>, newValue?: string) => {\n        setPromptTemplatePrefix(newValue || \"\");\n    };\n\n    const onPromptTemplateSuffixChange = (_ev?: React.FormEvent<HTMLInputElement | HTMLTextAreaElement>, newValue?: string) => {\n        setPromptTemplateSuffix(newValue || \"\");\n    };\n\n    const onRetrieveCountChange = (_ev?: React.SyntheticEvent<HTMLElement, Event>, newValue?: string) => {\n        setRetrieveCount(parseInt(newValue || \"3\"));\n    };\n\n    const onRetrievalModeChange = (_ev: React.FormEvent<HTMLDivElement>, option?: IDropdownOption<RetrievalMode> | undefined, index?: number | undefined) => {\n        setRetrievalMode(option?.data || RetrievalMode.Code);\n    };\n\n    const onUseSemanticRankerChange = (_ev?: React.FormEvent<HTMLElement | HTMLInputElement>, checked?: boolean) => {\n        setUseSemanticRanker(!!checked);\n    };\n\n    const onUseSemanticCaptionsChange = (_ev?: React.FormEvent<HTMLElement | HTMLInputElement>, checked?: boolean) => {\n        setUseSemanticCaptions(!!checked);\n    };\n\n    const onExcludeCategoryChanged = (_ev?: React.FormEvent, newValue?: string) => {\n        setExcludeCategory(newValue || \"\");\n    };\n\n    const onExampleClicked = (example: string) => {\n        makeApiRequest(example);\n    };\n\n    const onShowCitation = (citation: string) => {\n        if (activeCitation === citation && activeAnalysisPanelTab === AnalysisPanelTabs.CitationTab) {\n            setActiveAnalysisPanelTab(undefined);\n        } else {\n            setActiveCitation(citation);\n            setActiveAnalysisPanelTab(AnalysisPanelTabs.CitationTab);\n        }\n    };\n\n    const onToggleTab = (tab: AnalysisPanelTabs) => {\n        if (activeAnalysisPanelTab === tab) {\n            setActiveAnalysisPanelTab(undefined);\n        } else {\n            setActiveAnalysisPanelTab(tab);\n        }\n    };\n\n    const onUseOidSecurityFilterChange = (_ev?: React.FormEvent<HTMLElement | HTMLInputElement>, checked?: boolean) => {\n        setUseOidSecurityFilter(!!checked);\n    };\n\n    const onUseGroupsSecurityFilterChange = (_ev?: React.FormEvent<HTMLElement | HTMLInputElement>, checked?: boolean) => {\n        setUseGroupsSecurityFilter(!!checked);\n    };\n\n    return (\n        <div className={styles.oneshotContainer}>\n            <div className={styles.oneshotTopSection}>\n                <SettingsButton className={styles.settingsButton} onClick={() => setIsConfigPanelOpen(!isConfigPanelOpen)} />\n                <h1 className={styles.oneshotTitle}>Ask your data</h1>\n                <div className={styles.oneshotQuestionInput}>\n                    <QuestionInput\n                        placeholder=\"Example: Does my plan cover annual eye exams?\"\n                        disabled={isLoading}\n                        onSend={question => makeApiRequest(question)}\n                    />\n                </div>\n            </div>\n            <div className={styles.oneshotBottomSection}>\n                {isLoading && <Spinner label=\"Generating answer\" />}\n                {!lastQuestionRef.current && <ExampleList retrievalMode={retrievalMode} onExampleClicked={onExampleClicked} />}\n                {!isLoading && answer && !error && (\n                    <div className={styles.oneshotAnswerContainer}>\n                        <Answer\n                            answer={answer}\n                            isStreaming={false}\n                            retrievalMode={retrievalMode}\n                            onCitationClicked={x => onShowCitation(x)}\n                            onThoughtProcessClicked={() => onToggleTab(AnalysisPanelTabs.ThoughtProcessTab)}\n                            onSupportingContentClicked={() => onToggleTab(AnalysisPanelTabs.SupportingContentTab)}\n                        />\n                    </div>\n                )}\n                {error ? (\n                    <div className={styles.oneshotAnswerContainer}>\n                        <AnswerError error={error.toString()} onRetry={() => makeApiRequest(lastQuestionRef.current)} />\n                    </div>\n                ) : null}\n                {activeAnalysisPanelTab && answer && (\n                    <AnalysisPanel\n                        className={styles.oneshotAnalysisPanel}\n                        activeCitation={activeCitation}\n                        onActiveTabChanged={x => onToggleTab(x)}\n                        citationHeight=\"600px\"\n                        answer={answer}\n                        activeTab={activeAnalysisPanelTab}\n                    />\n                )}\n            </div>\n\n            <Panel\n                headerText=\"Configure answer generation\"\n                isOpen={isConfigPanelOpen}\n                isBlocking={false}\n                onDismiss={() => setIsConfigPanelOpen(false)}\n                closeButtonAriaLabel=\"Close\"\n                onRenderFooterContent={() => <DefaultButton onClick={() => setIsConfigPanelOpen(false)}>Close</DefaultButton>}\n                isFooterAtBottom={true}\n            >\n                {/* <TextField\n                    className={styles.oneshotSettingsSeparator}\n                    defaultValue={promptTemplate}\n                    label=\"Override prompt template\"\n                    multiline\n                    autoAdjustHeight\n                    onChange={onPromptTemplateChange}\n                />\n\n                <SpinButton\n                    className={styles.oneshotSettingsSeparator}\n                    label=\"Retrieve this many search results:\"\n                    min={1}\n                    max={50}\n                    defaultValue={retrieveCount.toString()}\n                    onChange={onRetrieveCountChange}\n                />\n                <TextField className={styles.oneshotSettingsSeparator} label=\"Exclude category\" onChange={onExcludeCategoryChanged} />\n                <Checkbox\n                    className={styles.oneshotSettingsSeparator}\n                    checked={useSemanticRanker}\n                    label=\"Use semantic ranker for retrieval\"\n                    onChange={onUseSemanticRankerChange}\n                />\n                <Checkbox\n                    className={styles.oneshotSettingsSeparator}\n                    checked={useSemanticCaptions}\n                    label=\"Use query-contextual summaries instead of whole documents\"\n                    onChange={onUseSemanticCaptionsChange}\n                    disabled={!useSemanticRanker}\n                />\n                {useLogin && (\n                    <Checkbox\n                        className={styles.oneshotSettingsSeparator}\n                        checked={useOidSecurityFilter}\n                        label=\"Use oid security filter\"\n                        disabled={!client?.getActiveAccount()}\n                        onChange={onUseOidSecurityFilterChange}\n                    />\n                )}\n                {useLogin && (\n                    <Checkbox\n                        className={styles.oneshotSettingsSeparator}\n                        checked={useGroupsSecurityFilter}\n                        label=\"Use groups security filter\"\n                        disabled={!client?.getActiveAccount()}\n                        onChange={onUseGroupsSecurityFilterChange}\n                    />\n                )} */}\n                <Dropdown\n                    className={styles.oneshotSettingsSeparator}\n                    label=\"Data mode\"\n                    options={[\n                        { key: \"code\", text: \"Hardened\", selected: retrievalMode == RetrievalMode.Code, data: RetrievalMode.Code },\n                        { key: \"text\", text: \"Regular\", selected: retrievalMode == RetrievalMode.Text, data: RetrievalMode.Text }\n                        // { key: \"vectors\", text: \"Vectors\", selected: retrievalMode == RetrievalMode.Vectors, data: RetrievalMode.Vectors },\n                        // { key: \"text\", text: \"Text\", selected: retrievalMode == RetrievalMode.Text, data: RetrievalMode.Text }\n                    ]}\n                    required\n                    onChange={onRetrievalModeChange}\n                />\n                {/* {useLogin && <TokenClaimsDisplay />} */}\n            </Panel>\n        </div>\n    );\n}\n\nComponent.displayName = \"OneShot\";\n"],"names":["SettingsButton","className","onClick","styles","jsx","Button","Settings24Regular","Component","isConfigPanelOpen","setIsConfigPanelOpen","useState","promptTemplate","setPromptTemplate","promptTemplatePrefix","setPromptTemplatePrefix","promptTemplateSuffix","setPromptTemplateSuffix","retrievalMode","setRetrievalMode","RetrievalMode","retrieveCount","setRetrieveCount","useSemanticRanker","setUseSemanticRanker","useSemanticCaptions","setUseSemanticCaptions","excludeCategory","setExcludeCategory","useOidSecurityFilter","setUseOidSecurityFilter","useGroupsSecurityFilter","setUseGroupsSecurityFilter","lastQuestionRef","useRef","isLoading","setIsLoading","error","setError","answer","setAnswer","activeCitation","setActiveCitation","activeAnalysisPanelTab","setActiveAnalysisPanelTab","client","useMsal","makeApiRequest","question","token","getToken","request","result","askApi","e","onRetrievalModeChange","_ev","option","index","onExampleClicked","example","onShowCitation","citation","AnalysisPanelTabs","onToggleTab","tab","jsxs","QuestionInput","Spinner","ExampleList","Answer","x","AnswerError","AnalysisPanel","Panel","DefaultButton","Dropdown"],"mappings":"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"}